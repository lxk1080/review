<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<title>Hello Map</title>

<style>
	html,body{height:100%; margin:0; padding:0; overflow:hidden;}
	#map{ width:50%; height:80%; border:#999 solid 1px;}
	#res{padding-left:20px; background:#333; color:#FFF;}
	#in{ position:absolute; top:20px; left:900px;}
	input{ margin:10px 2px;}
</style>

</head>

<body>

		<div id="map"></div>  <!--地图容器-->
        <br><div id="res"></div>
        <br>
        <div id="in">
        <input type="button" value="测距开启" onclick="myDis.open();" />
		<input type="button" value="测距关闭" onclick="myDis.close()" />
        <br>
        <input type="button" value="添加标注打开" onclick="mkrTool.open()" />
		<input type="button" value="添加标注关闭" onclick="mkrTool.close()" />
		<br>
		<input type="button" value="拉框打开" onclick="myDrag.open()" />
		<input type="button" value="拉框关闭" onclick="myDrag.close()" />
        <br>
        <input type="text" id="text" /><button onClick="sea()">搜索</button>
        <br>
        起点：<input type="text" id="start" />
        终点：<input type="text" id="end" />
        <button onClick="nav()">导航</button>
		<div>
		<div id="log"></div>



		<script src="http://lib.sinaapp.com/js/jquery/1.9.1/jquery-1.9.1.min.js"></script>
        
        <!--引入地图包，ak是密钥-->
		<script src="http://api.map.baidu.com/api?v=2.0&ak=Fz15PdNklypVhtqcrTMVbmbC8EESbzfE"></script>
        
        <!--地图工具lib-->
        <script src="http://api.map.baidu.com/library/MarkerManager/1.2/src/MarkerManager_min.js"></script>
        <script src="http://api.map.baidu.com/library/DistanceTool/1.2/src/DistanceTool_min.js"></script>
        <script src="http://api.map.baidu.com/library/MarkerTool/1.2/src/MarkerTool_min.js"></script>
        <script src="http://api.map.baidu.com/library/RectangleZoom/1.2/src/RectangleZoom_min.js"></script>



        
        <script>
        //1.0
		var map = new BMap.Map('map');  //创建地图实例，这里的allmap是地图容器的id 
		
		var point = new BMap.Point(116.404, 39.915);  //创建一个点对象，这里的参数是地图上的经纬度
		
		map.centerAndZoom(point,15); //地图的初始化，将地图的中心移动到刚才创建的点，这里的15是地图的缩放级别；数值越大，地图看的越细
		
		
		//2.0
		map.enableScrollWheelZoom();  //使用鼠标滚轮控制缩放
		
		
		//3.0
		//panTo()方法将让地图平滑移动至新中心点，如果移动距离超过了当前地图区域大小，则地图会直跳到该点
		//window.setTimeout(function(){map.panTo(new BMap.Point(121.409, 31.018));}, 2000);
		
		
		//4.0
		//map.addControl(new BMap.NavigationControl());  //地图平移缩放控件
		map.addControl(new BMap.ScaleControl());   //比例尺控件
		//map.addControl(new BMap.OverviewMapControl());  //缩略地图控件
		map.addControl(new BMap.MapTypeControl());  //地图类型控件
		//map.setCurrentCity("北京"); //仅当设置城市信息时，MapTypeControl 的切换功能才能可用
			
			
		//5.0	
		//anchor 表示控件的停靠位置，offset 表示控件位置偏移
		var opts = {anchor: BMAP_ANCHOR_BOTTOM_RIGHT, offset: new BMap.Size(10, 10)};
		map.addControl(new BMap.OverviewMapControl(opts));
		
		
		//6.0
		//修改控件外观
		var opts = {type: BMAP_NAVIGATION_CONTROL_LARGE}
		map.addControl(new BMap.NavigationControl(opts));				
		
		
		
		//7.0
		//添加自定义控件
		function ZoomControl(){
		// 设置默认停靠位置和偏移量
		this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
		this.defaultOffset = new BMap.Size(60, 10);
		}
		// 通过JavaScript 的prototype 属性继承于BMap.Control
		ZoomControl.prototype = new BMap.Control();
		
		ZoomControl.prototype.initialize = function(map){
		// 创建一个DOM 元素
		var div = document.createElement("div");
		// 添加文字说明
		div.appendChild(document.createTextNode("放大2级"));
		// 设置样式
		div.style.cursor = "pointer";
		div.style.border = "1px solid gray";
		div.style.backgroundColor = "white";
		// 绑定事件，点击一次放大两级
		div.onclick = function(e){
		map.zoomTo(map.getZoom() + 2);
		}
		// 添加DOM 元素到地图中
		map.getContainer().appendChild(div);
		// 将DOM 元素返回
		return div;
		}
		
		// 创建控件实例
		var myZoomCtrl = new ZoomControl();
		// 添加到地图当中
		map.addControl(myZoomCtrl);
			
			
		
		//8.0	
		//覆盖物
		var marker = new BMap.Marker(point); // 创建标注
		map.addOverlay(marker);
		
		function addMarker(point, index){
			// 创建图标对象
			var myIcon = new BMap.Icon(" http://api.map.baidu.com/images/marker_red_sprite.png", new BMap.Size(23, 25), {
			// 指定定位位置。
			// 当标注显示在地图上时，其所指向的地理位置距离图标左上
			// 角各偏移10像素和25像素。您可以看到在本例中该位置即是
			// 图标中央下端的尖角位置。
			offset: new BMap.Size(10, 25),
			// 设置图片偏移。
			// 当您需要从一幅较大的图片中截取某部分作为标注图标时，您
			// 需要指定大图的偏移位置，此做法与css sprites 技术类似。
			imageOffset: new BMap.Size(0, 0 - index * 25) // 设置图片偏移
			});
			// 创建标注对象并添加到地图
			var marker = new BMap.Marker(point, {icon: myIcon});
			map.addOverlay(marker);
			}
			
			// 随机向地图添加10个标注
			var bounds = map.getBounds();  //当前地图的视野范围
			var lngSpan = bounds.maxX - bounds.minX;
			var latSpan = bounds.maxY - bounds.minY;
			for (var i = 0; i < 10; i++) {
			var point = new BMap.Point(bounds.minX + lngSpan * (Math.random() * 0.7 + 0.15),
			bounds.minY + latSpan * (Math.random() * 0.7 + 0.15));
			addMarker(point, i);
			}
			
			
			
			//9.0
			//标注点击事件
			marker.addEventListener("click", function(){
			      alert("您点击了标注");
			});
			
			
			
			//10.0
			//标注可以被拖拽
			marker.enableDragging();  
			///拖拽完成后执行回调函数
			marker.addEventListener("dragend", function(e){
				res.innerHTML = "当前位置：" + e.point.lng + ", " + e.point.lat; //经纬度
			})
			
			
			//11.0
			//自1.1版本开始，删除标注后不需要使用marker.dispose()来释放内存资源，API 会自动帮助您完成此工作。
			//map.removeOverlay(marker);
			
			
			//12.0
			//信息窗口
			var opts = {
			  width : 250, // 信息窗口宽度
			  height: 100, // 信息窗口高度
			  title : "窗口" // 信息窗口标题
			}
			var infoWindow = new BMap.InfoWindow("只是一些提示信息", opts); // 创建信息窗口对象
			map.openInfoWindow(infoWindow, map.getCenter()); // 打开信息窗口
			
			
			
			//13.0
			//折线，用一个个的点连成的线
			/*
			var polyline = new BMap.Polyline([new BMap.Point(116.399, 39.910),new BMap.Point(116.405, 39.920),
			new BMap.Point(116.423, 39.928)],
			{strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5}
			)
			map.addOverlay(polyline);
			*/
			
			
			
			//14.0
			//移除覆盖物
			//map.removeOverlay(); //移除一个点
			//map.clearOverlays(); //删除所有覆盖物
			
			
			
			//15.0
			// 自定义覆盖物
			//定义构造函数并继承Overlay
			function SquareOverlay(center, length, color){
			this._center = center;
			this._length = length;
			this._color = color;
			}
			// 继承API 的BMap.Overlay
			SquareOverlay.prototype = new BMap.Overlay();
			
			// 实现初始化方法
			SquareOverlay.prototype.initialize = function(map){
			// 保存map 对象实例
			this._map = map;
			// 创建div 元素，作为自定义覆盖物的容器
			var div = document.createElement("div");
			div.style.position = "absolute";
			// 可以根据参数设置元素外观
			div.style.width = this._length + "px";
			div.style.height = this._length + "px";
			//这里带有前缀的属性以单词首字母大写的方式连接到一起
			div.style.webkitBorderRadius = this._length/2+'px'; 
			div.style.background = this._color;
			// 将div 添加到覆盖物容器中
			map.getPanes().markerPane.appendChild(div);
			// 保存div 实例
			this._div = div;
			// 需要将div 元素作为方法的返回值，当调用该覆盖物的show、
			// hide 方法，或者对覆盖物进行移除时，API 都将操作此元素。
			return div;
			}
			
			// 实现绘制方法
			SquareOverlay.prototype.draw = function(){
			// 根据地理坐标转换为像素坐标，并设置给容器
			var position = this._map.pointToOverlayPixel(this._center);
			this._div.style.left = position.x - this._length / 2 + "px";
			this._div.style.top = position.y - this._length / 2 + "px";
			}
			
			// 实现显示方法
			SquareOverlay.prototype.show = function(){
				if (this._div){
				this._div.style.display = "";
				}
			}
			// 实现隐藏方法
			SquareOverlay.prototype.hide = function(){
				if (this._div){
				this._div.style.display = "none";
				}
			}
						
			//添加覆盖物
			var mySquare = new SquareOverlay(map.getCenter(), 100, 'rgba(0,0,150,0.5)');
			map.addOverlay(mySquare);
			
			//移除覆盖物
			//map.removeOverlay(mySquare);
			
			
			
			
				
			//16.0
			//地图事件
			//事件监听
			/*
			map.addEventListener('click',function(){
				alert('click');	
			})
			*/
			//拖拽结束事件
			map.addEventListener('dragend',function(){
				var center = map.getCenter();
				var res = document.getElementById('res');
				res.innerHTML = '地图中心点为：'+ center.lng + ' , ' +center.lat;	
			})
			
			//监听函数会得到一个事件对象e，在e 中可以获取有关该事件的信息，例如坐标
			map.addEventListener("click", function(e){
				res.innerHTML = '此点坐标为：' + e.point.lng + " , " + e.point.lat;
			});
			
			//通过this 得到地图缩放后的级别
			map.addEventListener("zoomend", function(){
			res.innerHTML = "地图缩放至：" + this.getZoom() + "级";
			});
			
			//移除事件监听
			//用户第一次点击地图会触发事件监听函数，在函数内部对事件监听进行了移除，因此后续的点击操作则不会触发监听函数。
			/*  
			function showInfo(e){
				alert(e.point.lng + ", " + e.point.lat);
				map.removeEventListener("click", showInfo);
			}
			map.addEventListener("click", showInfo);
			*/
			
			
			
			
			//17.0
			//图层
			//添加和移除图层
			var traffic = new BMap.TrafficLayer(); // 创建交通流量图层实例
			map.addTileLayer(traffic); // 将图层添加到地图上
			//若要从地图上移除图层，需要调用map.removeTileLayer 方法。
			map.removeTileLayer(traffic);
			
			//自定义图层			
			var tilelayer = new BMap.TileLayer(); // 创建地图层实例
			tilelayer.getTilesUrl=function(){ // 设置图块路径
			return "img0.jpg";
			};
			map.addTileLayer(tilelayer); 
			map.removeTileLayer(tilelayer);
			
			
			
			//18.0
			//地图工具
			var myDis = new BMapLib.DistanceTool(map); //测距工具
			var mkrTool = new BMapLib.MarkerTool(map, {autoClose: false, followText: "连续添加标注"}); //添加标注工具
			var myDrag = new BMapLib.RectangleZoom(map, {followText: "拖拽鼠标进行操作"}); //拉框放大工具
			


			//19.0
			//地图服务
			//19.1本地搜索
			var options = {
			renderOptions: {
				map: map,  //在地图上显示地图实例
				panel: "log",  //结果列表容器
				autoViewport: true,  //自动调整地图视野
				selectFirstResult: false, //不显示第一条结果的信息窗口
			},  
			pageCapacity: 4 , //分页显示，每页显示4个结果
			
			/* 自定义容器
			onSearchComplete: function(results){
			if (local.getStatus() == BMAP_STATUS_SUCCESS){
			// 判断状态是否正确
			var s = [];
			for (var i = 0; i < results.getCurrentNumPois(); i ++){
				s.push(results.getPoi(i).title + ", " + results.getPoi(i).address);
			}
				document.getElementById("log").innerHTML = s.join("<br>");
			}
			}*/
			};
			var local = new BMap.LocalSearch('北京市', options);
			var text = document.getElementById('text');
			function sea(){
				local.search(text.value);
			}
			
			//19.2公交导航
			var transit = new BMap.TransitRoute(map, {
				renderOptions: {map: map, panel:'log'},
				pageCapacity: 3 ,
			});
			function nav(){
				transit.search(start.value, end.value);
			}
			
			//19.3驾车导航
			var driving = new BMap.DrivingRoute(map, {
				renderOptions: {
					map: map,
					autoViewport: true
				}
			});
			driving.search("中关村", "复兴门");
			
			
			
			//20.0
			//全景地图
			var stCtrl = new BMap.PanoramaControl();
			stCtrl.setOffset(new BMap.Size(10, 40));
			map.addControl(stCtrl);
			
			
			//21.0
			//设置地图底色
			var mapStyle ={
			features: ["road", "building","water","land","point"], //道路 建筑 水域 陆地 兴趣点
			style : "normal",   //dark:深色  light:浅色
			}
			map.setMapStyle(mapStyle);
						
				
        </script>
        

</body>
</html>
