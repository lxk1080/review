<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <!--<meta name="viewport" -->
        <!--content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">-->
  <title>Test</title>
</head>
<body>

<!--
 发布者
    包含订阅者
    可以发布信息
 订阅者
    可以订阅
    可以取消订阅
    可以接收信息并更新（所以它自成一个函数）
-->

<input type="button" value="第一报社"><input type="text" id="pub1" value=""><br/><br/>
<input type="button" value="第二报社"><input type="text" id="pub2" value=""><br/><br/>
<input type="button" value="第三报社"><input type="text" id="pub3" value=""><br/><br/>

<textarea id="sub1" rows="10" cols="30"></textarea>
<textarea id="sub2" rows="10" cols="30"></textarea>

<script>

class Publish {
    constructor(name) {
        this.name = name
        this.subs = []
        this.init()
    }

    init() {
        let self = this
        let node = document.querySelector(this.name)
        node.addEventListener('keyup', function() {
            self.deliver(node.value)
        })
    }

    deliver(news) {
        let pub = this
        this.subs.forEach((sub) => {
            sub.update(news, pub)
        })
        return this
    }
}

class Sub {
    constructor(name) {
        this.name = name
    }

    update(news, pub) {
        document.querySelector(this.name).innerHTML = `${pub.name.substr(1)}: ${news}`
    }

    subscribe(pub) {
        let self = this
        let target = pub.subs.find((item) => {
            return item == self
        })
        if (!target) {
            pub.subs.push(self)
        }
        return self
    }

    unsubscribe(pub) {
        let self = this
        pub.subs = pub.subs.filter((sub) => {
            return sub.name !== self.name
        })
        return self
    }
}

window.addEventListener('DOMContentLoaded', function() {
    let pub1 = new Publish('#pub1')
    let pub2 = new Publish('#pub2')
    let pub3 = new Publish('#pub3')

    let sub1 = new Sub('#sub1')
    let sub2 = new Sub('#sub2')

    sub1.subscribe(pub1).subscribe(pub2)
    sub2.subscribe(pub2).subscribe(pub3)
    sub1.unsubscribe(pub2)
})


</script>
</body>
</html>